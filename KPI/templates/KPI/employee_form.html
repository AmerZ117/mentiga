{% extends 'KPI/base.html' %}

{% block title %}{{ title }} - Mentiga Corporation Berhad{% endblock %}

{% block content %}
<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h1><i class="fas fa-user me-2"></i>{{ title }}</h1>
            <p class="text-muted mb-0">{% if employee %}Edit employee information{% else %}Add a new employee to the system{% endif %}</p>
        </div>
        <div class="col-auto">
            <a href="{% url 'KPI:employee_list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Employees
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-user-edit me-2"></i>Employee Information
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3">Personal Information</h6>
                            
                            <div class="mb-3">
                                <label for="{{ form.employee_id.id_for_label }}" class="form-label">
                                    Employee ID <span class="text-danger">*</span>
                                </label>
                                {{ form.employee_id }}
                                {% if form.employee_id.errors %}
                                    <div class="text-danger small">{{ form.employee_id.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label">
                                    First Name <span class="text-danger">*</span>
                                </label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="text-danger small">{{ form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label">
                                    Last Name <span class="text-danger">*</span>
                                </label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="text-danger small">{{ form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    Email <span class="text-danger">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger small">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.phone.id_for_label }}" class="form-label">Phone</label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                    <div class="text-danger small">{{ form.phone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Employment Information -->
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3">Employment Information</h6>
                            
                            <div class="mb-3">
                                <label for="{{ form.department.id_for_label }}" class="form-label">
                                    Department <span class="text-danger">*</span>
                                </label>
                                {{ form.department }}
                                {% if form.department.errors %}
                                    <div class="text-danger small">{{ form.department.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.position.id_for_label }}" class="form-label">
                                    Position <span class="text-danger">*</span>
                                </label>
                                {{ form.position }}
                                {% if form.position.errors %}
                                    <div class="text-danger small">{{ form.position.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.hire_date.id_for_label }}" class="form-label">
                                    Hire Date <span class="text-danger">*</span>
                                </label>
                                {{ form.hire_date }}
                                {% if form.hire_date.errors %}
                                    <div class="text-danger small">{{ form.hire_date.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.status.id_for_label }}" class="form-label">
                                    Status <span class="text-danger">*</span>
                                </label>
                                {{ form.status }}
                                {% if form.status.errors %}
                                    <div class="text-danger small">{{ form.status.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.manager.id_for_label }}" class="form-label">Manager</label>
                                {{ form.manager }}
                                {% if form.manager.errors %}
                                    <div class="text-danger small">{{ form.manager.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.user.id_for_label }}" class="form-label">User Account</label>
                                {{ form.user }}
                                {% if form.user.errors %}
                                    <div class="text-danger small">{{ form.user.errors.0 }}</div>
                                {% endif %}
                                <small class="text-muted">Link to Django user account (optional)</small>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'KPI:employee_list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            {% if employee %}Update Employee{% else %}Create Employee{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Help Panel -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Help</h5>
            </div>
            <div class="card-body">
                <h6>Required Fields</h6>
                <p class="small text-muted">Fields marked with <span class="text-danger">*</span> are required.</p>
                
                <h6>Employee ID</h6>
                <p class="small text-muted">Must be unique. Use a consistent format like EMP001, EMP002, etc.</p>
                
                <h6>Department</h6>
                <p class="small text-muted">Select the department where the employee will work.</p>
                
                <h6>Manager</h6>
                <p class="small text-muted">Optional. Select the employee's direct supervisor.</p>
                
                <h6>User Account</h6>
                <p class="small text-muted">Link to a Django user account if the employee needs system access.</p>
                
                <hr>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Tip:</strong> After creating an employee, you can immediately create their first evaluation.
                </div>
            </div>
        </div>
        
        {% if employee %}
        <!-- Employee Quick Stats -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Quick Stats</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                    <span>Evaluations:</span>
                    <span class="badge bg-primary">{{ employee.evaluation_set.count }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Goals:</span>
                    <span class="badge bg-info">{{ employee.goal_set.count }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Training:</span>
                    <span class="badge bg-success">{{ employee.training_set.count }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Team Size:</span>
                    <span class="badge bg-warning">{{ employee.employee_set.count }}</span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-generate employee ID if not provided
document.getElementById('{{ form.employee_id.id_for_label }}').addEventListener('blur', function() {
    if (!this.value) {
        // Generate a simple ID - in production, you might want a more sophisticated approach
        const timestamp = Date.now().toString().slice(-6);
        this.value = 'EMP' + timestamp;
    }
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const requiredFields = this.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
        } else {
            field.classList.remove('is-invalid');
        }
    });
    
    if (!isValid) {
        e.preventDefault();
        alert('Please fill in all required fields.');
    }
});

// Remove validation styling when user starts typing
document.querySelectorAll('input, select').forEach(field => {
    field.addEventListener('input', function() {
        this.classList.remove('is-invalid');
    });
});
</script>
{% endblock %}



