{% extends 'KPI/base.html' %}

{% block title %}Reports - Mentiga Corporation Berhad{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-chart-bar me-2"></i>Reports & Analytics</h1>
    <p class="text-muted">Generate comprehensive reports for staff evaluation, goals, training, and performance analysis</p>
</div>

<div class="row">
    <!-- Report Statistics -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle me-2"></i>Report Statistics</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h3 class="text-primary">{{ total_reports }}</h3>
                        <p class="text-muted">Total Reports</p>
                    </div>
                    <div class="col-6">
                        <h3 class="text-success">{{ recent_reports.count }}</h3>
                        <p class="text-muted">Recent Reports</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <a href="#employee-performance" class="btn btn-outline-primary btn-sm w-100 mb-2">
                            <i class="fas fa-users me-1"></i> Employee Performance
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="#department-performance" class="btn btn-outline-success btn-sm w-100 mb-2">
                            <i class="fas fa-building me-1"></i> Department Performance
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="#training-report" class="btn btn-outline-info btn-sm w-100 mb-2">
                            <i class="fas fa-graduation-cap me-1"></i> Training Report
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="#goal-progress" class="btn btn-outline-warning btn-sm w-100 mb-2">
                            <i class="fas fa-bullseye me-1"></i> Goal Progress
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Generation Forms -->
<div class="row mt-4">
    <!-- Employee Performance Report -->
    <div class="col-md-6 mb-4">
        <div class="card" id="employee-performance">
            <div class="card-header">
                <h5><i class="fas fa-users me-2"></i>Employee Performance Report</h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'KPI:generate_report' %}">
                    {% csrf_token %}
                    <input type="hidden" name="report_type" value="employee_performance">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Format</label>
                                <select name="format" class="form-select">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Department</label>
                                <select name="department" class="form-select">
                                    <option value="">All Departments</option>
                                    {% for dept in departments %}
                                        <option value="{{ dept.id }}">{{ dept.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Evaluation Period</label>
                                <select name="period" class="form-select">
                                    <option value="">All Periods</option>
                                    {% for period in periods %}
                                        <option value="{{ period.id }}">{{ period.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Status</label>
                                <select name="status" class="form-select">
                                    <option value="">All Statuses</option>
                                    <option value="draft">Draft</option>
                                    <option value="submitted">Submitted</option>
                                    <option value="reviewed">Reviewed</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date From</label>
                                <input type="date" name="date_from" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date To</label>
                                <input type="date" name="date_to" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-download me-1"></i>Generate Report
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Department Performance Report -->
    <div class="col-md-6 mb-4">
        <div class="card" id="department-performance">
            <div class="card-header">
                <h5><i class="fas fa-building me-2"></i>Department Performance Report</h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'KPI:generate_report' %}">
                    {% csrf_token %}
                    <input type="hidden" name="report_type" value="department_performance">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Format</label>
                                <select name="format" class="form-select">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Department</label>
                                <select name="department" class="form-select">
                                    <option value="">All Departments</option>
                                    {% for dept in departments %}
                                        <option value="{{ dept.id }}">{{ dept.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date From</label>
                                <input type="date" name="date_from" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date To</label>
                                <input type="date" name="date_to" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-download me-1"></i>Generate Report
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Training Report -->
    <div class="col-md-6 mb-4">
        <div class="card" id="training-report">
            <div class="card-header">
                <h5><i class="fas fa-graduation-cap me-2"></i>Training Report</h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'KPI:generate_report' %}">
                    {% csrf_token %}
                    <input type="hidden" name="report_type" value="training">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Format</label>
                                <select name="format" class="form-select">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Training Type</label>
                                <select name="training_type" class="form-select">
                                    <option value="">All Types</option>
                                    <option value="technical">Technical Training</option>
                                    <option value="soft_skills">Soft Skills Training</option>
                                    <option value="leadership">Leadership Training</option>
                                    <option value="compliance">Compliance Training</option>
                                    <option value="certification">Certification</option>
                                    <option value="workshop">Workshop</option>
                                    <option value="seminar">Seminar</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Department</label>
                                <select name="department" class="form-select">
                                    <option value="">All Departments</option>
                                    {% for dept in departments %}
                                        <option value="{{ dept.id }}">{{ dept.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Status</label>
                                <select name="status" class="form-select">
                                    <option value="">All Statuses</option>
                                    <option value="planned">Planned</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                    <option value="postponed">Postponed</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date From</label>
                                <input type="date" name="date_from" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date To</label>
                                <input type="date" name="date_to" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-download me-1"></i>Generate Report
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Goal Progress Report -->
    <div class="col-md-6 mb-4">
        <div class="card" id="goal-progress">
            <div class="card-header">
                <h5><i class="fas fa-bullseye me-2"></i>Goal Progress Report</h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'KPI:generate_report' %}">
                    {% csrf_token %}
                    <input type="hidden" name="report_type" value="goal_progress">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Format</label>
                                <select name="format" class="form-select">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Goal Type</label>
                                <select name="goal_type" class="form-select">
                                    <option value="">All Types</option>
                                    <option value="performance">Performance Goal</option>
                                    <option value="development">Development Goal</option>
                                    <option value="project">Project Goal</option>
                                    <option value="personal">Personal Goal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Department</label>
                                <select name="department" class="form-select">
                                    <option value="">All Departments</option>
                                    {% for dept in departments %}
                                        <option value="{{ dept.id }}">{{ dept.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Status</label>
                                <select name="status" class="form-select">
                                    <option value="">All Statuses</option>
                                    <option value="pending">Pending</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="overdue">Overdue</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Priority</label>
                                <select name="priority" class="form-select">
                                    <option value="">All Priorities</option>
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date From</label>
                                <input type="date" name="date_from" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-download me-1"></i>Generate Report
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Recent Reports -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-history me-2"></i>Recent Reports</h5>
            </div>
            <div class="card-body">
                {% if recent_reports %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Report Name</th>
                                    <th>Type</th>
                                    <th>Format</th>
                                    <th>Generated By</th>
                                    <th>Generated At</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for report in recent_reports %}
                                <tr>
                                    <td>{{ report.name }}</td>
                                    <td>
                                        <span class="badge bg-primary">{{ report.get_report_type_display }}</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ report.get_format_display }}</span>
                                    </td>
                                    <td>{{ report.generated_by.username }}</td>
                                    <td>{{ report.generated_at|date:"M d, Y H:i" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-file-alt fa-3x mb-3"></i>
                        <p>No reports generated yet.</p>
                        <p>Generate your first report using the forms above.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Report Features -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-star me-2"></i>Report Features</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <i class="fas fa-file-pdf fa-2x text-danger mb-2"></i>
                        <h6>PDF Reports</h6>
                        <p class="text-muted small">Professional PDF reports with Mentiga branding</p>
                    </div>
                    <div class="col-md-3 text-center">
                        <i class="fas fa-file-excel fa-2x text-success mb-2"></i>
                        <h6>Excel Export</h6>
                        <p class="text-muted small">Data analysis ready Excel spreadsheets</p>
                    </div>
                    <div class="col-md-3 text-center">
                        <i class="fas fa-file-csv fa-2x text-info mb-2"></i>
                        <h6>CSV Format</h6>
                        <p class="text-muted small">Comma-separated values for data processing</p>
                    </div>
                    <div class="col-md-3 text-center">
                        <i class="fas fa-filter fa-2x text-warning mb-2"></i>
                        <h6>Advanced Filtering</h6>
                        <p class="text-muted small">Filter by department, date range, and status</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Smooth scrolling for quick action links
    $('a[href^="#"]').on('click', function(event) {
        var target = $(this.getAttribute('href'));
        if (target.length) {
            event.preventDefault();
            $('html, body').stop().animate({
                scrollTop: target.offset().top - 100
            }, 1000);
        }
    });
    
    // Form validation
    $('form').on('submit', function() {
        var form = $(this);
        var submitBtn = form.find('button[type="submit"]');
        var originalText = submitBtn.html();
        
        submitBtn.html('<i class="fas fa-spinner fa-spin me-1"></i>Generating...');
        submitBtn.prop('disabled', true);
        
        // Re-enable after 5 seconds in case of error
        setTimeout(function() {
            submitBtn.html(originalText);
            submitBtn.prop('disabled', false);
        }, 5000);
    });
});
</script>
{% endblock %}




